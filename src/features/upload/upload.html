<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ä¸Šä¼ å® ç‰© GIF</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      padding: 20px;
    }
    select, input[type="file"] {
      margin: 10px 0;
      width: 100%;
    }
    button {
      padding: 8px 16px;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    img {
      max-width: 100px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>ä¸Šä¼ ä½ çš„å® ç‰© GIF</h2>

  <label for="action">é€‰æ‹©åŠ¨ä½œ:</label>
  <select id="action">
    <option value="idle">é»˜è®¤</option>
    <option value="struggle">æŒ£æ‰</option>
    <option value="eatA">é£Ÿç‰©A</option>
    <option value="eatB">é£Ÿç‰©B sleep</option>
    <option value="eatC">é£Ÿç‰©C happy</option>
    <option value="hungry">é¥¿</option>
    <option value="comfort">comfort</option>
  </select>

  <button onclick="selectAndUpload()">é€‰æ‹©å¹¶ä¸Šä¼  GIF</button>

  <p id="status"></p>
  <img id="preview" src="" alt="é¢„è§ˆå›¾" />

  <script>
async function selectAndUpload() {
  const status = document.getElementById("status");
  const preview = document.getElementById("preview");

  try {
    const filePath = await window.gifAPI?.selectGifFile();

    if (!filePath) {
      status.textContent = "âŒ ä½ å–æ¶ˆäº†æ–‡ä»¶é€‰æ‹©";
      return;
    }

    status.textContent = "âœ… é€‰æ‹©çš„è·¯å¾„æ˜¯ï¼š" + filePath;

    // ğŸŸ¡ è¯»å–æœ¬åœ°å›¾ç‰‡ä½œä¸ºé¢„è§ˆï¼ˆbase64ï¼‰
    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
    };

    // ä½¿ç”¨ input[type=file] ä¹Ÿå¯ä»¥æ‹¿åˆ° File å¯¹è±¡ï¼Œä½†æˆ‘ä»¬æ˜¯ç”¨ Electron çš„è·¯å¾„
    // æ‰€ä»¥è¿™é‡Œç”¨ fetch è¯»å–æ–‡ä»¶å†è½¬æˆ blob
    const response = await fetch("file://" + filePath);
    const blob = await response.blob();
    reader.readAsDataURL(blob);

    // ğŸŸ¢ å‘é€ç»™ä¸»è¿›ç¨‹å¤åˆ¶
    const action = document.getElementById("action").value;
    window.gifAPI.uploadGIF(action, filePath);

  } catch (err) {
    status.textContent = "âŒ é”™è¯¯ï¼š" + err.message;
    console.error(err);
  }
}


  </script>
</body>
</html>

