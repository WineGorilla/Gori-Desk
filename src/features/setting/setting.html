<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>è®¾ç½®</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
    }

    h2 {
      margin-top: 30px;
      color: #444;
    }

    .setting-group {
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    select, input[type="range"] {
      width: 100%;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .switch {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 10px;
    }

    .switch input {
      width: auto;
    }

    #saveBtn {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }

    #saveBtn:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

    <!-- åŠ ä¸€ä¸ªåŠ è½½æç¤º -->
    <div id="loading" style="text-align:center; margin-top: 100px;">æ­£åœ¨åŠ è½½è®¾ç½®ä¸­...</div>
  
    <!-- ä¸»å†…å®¹åŒºåŸŸï¼šåˆå§‹éšè—ï¼ŒåŠ è½½å®Œåæ˜¾ç¤º -->
    <div id="mainUI" style="display: none;">
  
      <h1 id="titleText">è®¾ç½® Settings</h1>
  
      <div class="setting-group">
        <h2 id="langTitle">ğŸŒ è¯­è¨€ Language</h2>
        <label for="languageSelect" id="langLabel">é€‰æ‹©è¯­è¨€ / Select Language:</label>
        <select id="languageSelect">
          <option value="zh">ä¸­æ–‡</option>
          <option value="en">English</option>
        </select>
      </div>
  
      <div class="setting-group">
        <h2 id="modelTitle">ğŸ¤– æ¨¡å‹é€‰æ‹© AI Model</h2>
        <label for="modelSelect" id="modelLabel">é€‰æ‹©å¤§è¯­è¨€æ¨¡å‹:</label>
        <select id="modelSelect">
          <option value="phi">RWKV</option>
          <option value="ollama">Ollama</option>
        </select>
      </div>
  
      <div class="setting-group">
        <h2 id="transTitle">ğŸŒ«ï¸ æ¡Œå® é€æ˜åº¦ Transparency</h2>
        <label for="transparencyRange" id="transLabel">é€æ˜åº¦ (0% ~ 100%):</label>
        <input type="range" id="transparencyRange" min="20" max="100" step="1">
      </div>
  
      <div class="setting-group">
        <h2 id="startupTitle">âš™ï¸ å¯åŠ¨é¡¹ Startup</h2>
        <div class="switch">
          <label for="autoLaunch" id="autoLaunchLabel">å¼€æœºè‡ªå¯:</label>
          <input type="checkbox" id="autoLaunch">
        </div>
      </div>
  
      <div class="setting-group">
        <h2 id="chatTitle">ğŸ’¬ å¯¹è¯åŠŸèƒ½ Chat</h2>
        <div class="switch">
          <label for="enableChat" id="chatLabel">å¯ç”¨å¯¹è¯:</label>
          <input type="checkbox" id="enableChat">
        </div>
      </div>
  
      <button id="saveBtn">ä¿å­˜è®¾ç½® / Save Settings</button>
    </div>

<script>
// setting.js

// ğŸŒ å¤šè¯­è¨€å­—å…¸é…ç½®
const i18n = {
  zh: {
    title: "è®¾ç½®",
    language: "ğŸŒ è¯­è¨€ Language",
    selectLanguage: "é€‰æ‹©è¯­è¨€ / Select Language:",
    modelTitle: "ğŸ¤– æ¨¡å‹é€‰æ‹© AI Model",
    selectModel: "é€‰æ‹©å¤§è¯­è¨€æ¨¡å‹:",
    transparencyTitle: "ğŸŒ«ï¸ æ¡Œå® é€æ˜åº¦ Transparency",
    transparencyLabel: "é€æ˜åº¦ (0% ~ 100%):",
    startupTitle: "âš™ï¸ å¯åŠ¨é¡¹ Startup",
    autoLaunch: "å¼€æœºè‡ªå¯:",
    chatTitle: "ğŸ’¬ å¯¹è¯åŠŸèƒ½ Chat",
    enableChat: "å¯ç”¨å¯¹è¯:",
    save: "ä¿å­˜è®¾ç½®"
  },
  en: {
    title: "Settings",
    language: "ğŸŒ Language",
    selectLanguage: "Choose Language:",
    modelTitle: "ğŸ¤– AI Model Selection",
    selectModel: "Choose AI Model:",
    transparencyTitle: "ğŸŒ«ï¸ Pet Transparency",
    transparencyLabel: "Transparency (0% ~ 100%):",
    startupTitle: "âš™ï¸ Startup",
    autoLaunch: "Auto Launch:",
    chatTitle: "ğŸ’¬ Chat Feature",
    enableChat: "Enable Chat:",
    save: "Save Settings"
  }
};

// ğŸ”„ åº”ç”¨ç•Œé¢è¯­è¨€
function updateLanguage(lang) {
  const t = i18n[lang] || i18n.zh;

  document.title = t.title;
  document.getElementById("titleText").textContent = t.title;
  document.getElementById("langTitle").textContent = t.language;
  document.getElementById("langLabel").textContent = t.selectLanguage;
  document.getElementById("modelTitle").textContent = t.modelTitle;
  document.getElementById("modelLabel").textContent = t.selectModel;
  document.getElementById("transTitle").textContent = t.transparencyTitle;
  document.getElementById("transLabel").textContent = t.transparencyLabel;
  document.getElementById("startupTitle").textContent = t.startupTitle;
  document.getElementById("autoLaunchLabel").textContent = t.autoLaunch;
  document.getElementById("chatTitle").textContent = t.chatTitle;
  document.getElementById("chatLabel").textContent = t.enableChat;
  document.getElementById("saveBtn").textContent = t.save;
}

// ğŸ“¦ åˆå§‹åŒ–è®¾ç½®
async function initSettings() {
  try {
    console.log("ğŸ› ï¸ æ­£åœ¨å°è¯•è¯»å–è®¾ç½®...");
    if (!window.settingAPI) throw new Error("âŒ settingAPI ä¸å­˜åœ¨");

    const settings = await window.settingAPI.getSettings();
    console.log("âœ… è®¾ç½®è¯»å–æˆåŠŸ:", settings);

    if (!settings || typeof settings !== "object") throw new Error("âŒ è®¾ç½®è¿”å›æ— æ•ˆ");

    // åˆå§‹åŒ–è¡¨å•æ§ä»¶
    document.getElementById("languageSelect").value = settings.language;
    document.getElementById("modelSelect").value = settings.model;
    document.getElementById("transparencyRange").value = settings.transparency;
    document.getElementById("autoLaunch").checked = settings.autoLaunch;
    document.getElementById("enableChat").checked = settings.enableChat;

    // åº”ç”¨è¯­è¨€
    updateLanguage(settings.language);

    // æ˜¾ç¤ºä¸»UI
    document.getElementById("loading").style.display = "none";
    document.getElementById("mainUI").style.display = "block";
  } catch (err) {
    console.error("âŒ è®¾ç½®åŠ è½½å¤±è´¥:", err);
    document.getElementById("loading").innerHTML =
      '<span style="color:#e74c3c;font-size:20px">âŒ è®¾ç½®åŠ è½½å¤±è´¥ï¼Œè¯·é‡å¯åº”ç”¨</span>';
  }
}

// ğŸ’¾ ä¿å­˜è®¾ç½®
function bindSaveButton() {
  document.getElementById("saveBtn").addEventListener("click", () => {
    const settings = {
      language: document.getElementById("languageSelect").value,
      model: document.getElementById("modelSelect").value,
      transparency: parseInt(document.getElementById("transparencyRange").value),
      autoLaunch: document.getElementById("autoLaunch").checked,
      enableChat: document.getElementById("enableChat").checked
    };

    window.settingAPI.saveSettings(settings);
    updateLanguage(settings.language);

    alert(settings.language === "zh" ? "è®¾ç½®å·²ä¿å­˜ï¼" : "Settings saved!");
  });
}

// ğŸŒ è¯­è¨€åˆ‡æ¢åŒæ­¥ä¸»çª—å£
function bindLanguageChange() {
  document.getElementById("languageSelect").addEventListener("change", () => {
    const lang = document.getElementById("languageSelect").value;
    updateLanguage(lang);
    window.settingAPI.changeLanguage(lang);

    // è‡ªåŠ¨ä¿å­˜è¯­è¨€å­—æ®µ
    window.settingAPI.getSettings().then((settings) => {
      settings.language = lang;
      window.settingAPI.saveSettings(settings);
    });

    console.log("[è®¾ç½®é¡µ] åˆ‡æ¢è¯­è¨€å¹¶åŒæ­¥:", lang);
  });
}

// ğŸŒ«ï¸ å®æ—¶é€æ˜åº¦è°ƒæ•´
function bindTransparencyChange() {
  document.getElementById("transparencyRange").addEventListener("input", (e) => {
    const value = parseInt(e.target.value);
    window.settingAPI.sendTransparencyToMain(value);
  });
}

// ğŸš€ é¡µé¢åŠ è½½ååˆå§‹åŒ–
window.addEventListener("DOMContentLoaded", () => {
  initSettings();
  bindSaveButton();
  bindLanguageChange();
  bindTransparencyChange();
});

</script>


</body>
</html>

